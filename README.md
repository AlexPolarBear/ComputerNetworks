## Homework 7. ***Транспортный уровень***

## 1. Wireshark: TCP

### Вопросы

1. IP адрес отправителя (Source Address) - 192.168.0.103 и порт (Source Port) - 50871

2. IP адрес gaia.cs.umass.edu (Destination Address) - 128.119.245.12 c портом (Destination Port) - 80. Для отправки порт - 50871.

    ![plot](/pictures/1.PNG)

### Основы TCP

3. Порядковый номер SYN сегмента - 0. То что это SYN сегмент указывает флаг (установленный в 1).

    ![plot](/pictures/2.PNG)

4. Порядковый номер SYN - 0, порядковый номер ACK - 1. Сервер определил это значение прибавив 1 к порядковому номеру запрашиваемого SYN-сегмента. В SYNACK-сегменте флаги SYN и ACK установлены в 1.

    ![plot](/pictures/3.PNG)

5. Sequence Number: 152025 (relative sequence number)

    ![plot](/pictures/4.PNG)

6. Порядковые номера у первых 6 сегментов: 137, 138, 139, 140, 141, 142. Сам HTTP запрос имеет номер 285. Каждый сегмент был отправлен до HTTP запроса, почти сразу после SYN-ACK запроса. ACK-пакеты приходили после того, как сегмент был доставлен и привязан к нему [This is an ACK to the segment in frame: 149].

    ![plot](/pictures/5.PNG)

    Время отправки каждого сегмента и получения ACK:

    |     | SENT      | ACK       | RTT      |
    | :-: | :-------: | :-------: | :------: |
    | 137 | 15.131355 | 15.257033 | 0.125678 |
    | 138 | 15.131840 | 15.257033 | 0.125193 |
    | 139 | 15.131840 | 15.259862 | 0.128022 |
    | 140 | 15.131840 | 15.259862 | 0.128022 |
    | 141 | 15.131840 | 15.259862 | 0.128022 |
    | 142 | 15.131840 | 15.259862 | 0.128022 |

    Как видно из таблицы - разность времени отправки и получения подтверждения и есть значение RTT.

![plot](/pictures/6.PNG)

7. Пропускная способность = длина пакета / RTT.

    Допустим, для 137 сегмента:

    $$\ Пропускная \ способность = 876 / 0.125678 = 6970.2 \ байт/сек. $$

    Для всей передачи файла скорее всего нужно вычислить среднее значение по пропускной способности каждого сегмента.

## 2. Wireshark: Работа с Time-Sequence-Graph (Stevens)

![plot](/pictures/7.PNG)

## 3. Задачки

### Задача 1

Необходимо чтобы все порядковые номера вмещались в окно отправителя и получателя, то есть пространство порядковых номеров должно быть достаточно большим (чтобы больший номер не перекрывался меньшим).

Предположим, что окно имеет размер $\ { [ a , \ x + y - 1 ] }$ и меньший порядковый номер, ожидаемый получателем - пакет $\ {a} $. Следовательно, получатель уже подтвердил получение (ACK) пакета $\ a-1 $ и все пакеты до этого. Пусть $\ { y }$ - размер окна, и если ни один из $\ { y }$ ACK-ов еще не был получен отправителем, то сообщения со значениями $\ { [ a - y , \ a - 1 ] }$ все еще могут распространяться обратно, и окно будет иметь такой размер.

Значит нижняя граница для отправителя равна $\ a - y $, а для получателя - $\ a + y - 1 $. Можно предположить, что пространство длля порядковых номеров должно быть как минимум в 2 раза больше размера окна.

### Задача 2

Чтобы передать пакет по каналу связи необходимо затратить время:

$$\ d_{передачи} = L/R = 1500 * 8 / 10^9 = 12 * 10^{-6} = 12 \ мкс. $$

Рассчитаем размер окна (количество пакетов), для 98% - минимальная граница.

$$\ 0.98 = N * (d_{передачи}) / (d_{передачи} + RTT) => $$

$$\ N = 0.98 * 30.012 / 0.012 = 2450.98 ≈ 2451. $$

Соответственно, размер окна должен быть как минимум 2451 пакетов, чтобы использовать его при 98%.

<ins> Ответ:</ins> 2451 пакетов.
